// Manifest for pipeline
manifest {
    name = 'Chai-1-nf'
    author = 'Chai Discovery '
    homePage = 'https://github.com/chaidiscovery/chai-lab'
    description = 'Nextflow pipeline for Chai 1 - a multi-modal foundation model for molecular structure prediction'
    mainScript = 'main.nf'
    nextflowVersion = '>=22.10.1'
    version = '0.0.1'
}

// Global default params, used in configs
params {
    // Workflow flags
    outdir = 'results'
    tracedir = "${params.outdir}/pipeline_info"
    publish_dir_mode = 'copy'

    // Boilerplate options
    help = false
    version = false
}

// Process configuration
process {

    accelerator = 1
    cpus = 6
    memory = '32.GB'
    time = '4.h'

    errorStrategy = { task.exitStatus in [143, 137, 104, 134, 139] ? 'retry' : 'finish' }
    maxRetries = 1
    maxErrors = '-1'

    // Default container settings
    //container = 'chailab:latest'

    // Default publishing settings
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
        mode: params.publish_dir_mode,
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]
}

// Location to download model
env {
    CHAI_DOWNLOADS_DIR = "${projectDir}"
}

// Seqera Platform configuration
tower {
    enabled = false
    // Set to true when using Seqera Platform
    accessToken = null
    // Add your Seqera access token here
    workspaceId = null
}


/*
 * Base Nextflow configuration file with default settings
 */
wave.enabled = true
wave.strategy = ['conda']

// Execution profiles
profiles {
    debug {
        process.beforeScript = 'echo $HOSTNAME'
    }

    conda {
        docker.enabled = false
        singularity.enabled = false
        conda.enabled = true
    }
    docker {
        docker.enabled = true
        singularity.enabled = false
        conda.enabled = false
    }
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        docker.enabled = false
        conda.enabled = false
    }
    test {
        params {
            max_cpus = 2
            max_memory = '6.GB'
        }
    }
}
